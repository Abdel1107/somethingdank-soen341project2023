{% extends "employer_portal/base.html" %}
{% block title %} Job Postings | Connect-U Employers {% endblock title %}
{% block content %}
    <div class="container-fluid">
        <h2 class="text-left mb-5" style="color: #004085;"><span class="fa fa-search"></span> Current Listings</h2>
        <div class="row">
           <form class="form-inline my-2 my-lg-0" method="GET">
              <div class="input-group">
                 <input class="form-control" type="search" placeholder="Search Job Title" aria-label="Search" name="search">
                 <div class="input-group-append">
                    <button class="btn btn-outline-info" type="submit">Search</button>
                    {% if request.GET.search %}
                    <a href="{% url 'employer_portal-manage_job_postings' %}" class="btn btn-secondary ml-2">Show All</a>
                    {% endif %}
                 </div>
              </div>
              <div class="input-group ml-3">
                 <div class="input-group-prepend">
                    <label class="input-group-text" for="jobType">Job Type</label>
                 </div>
                 <select class="custom-select" id="jobType" name="job_type">
                 <option value="" {% if not request.GET.job_type %}selected{% endif %}>All</option>
                 <option value="Full-time" {% if request.GET.job_type == "Full-time" %}selected{% endif %}>Full-time</option>
                 <option value="Part-time" {% if request.GET.job_type == "Part-time" %}selected{% endif %}>Part-time</option>
                 <option value="Contract" {% if request.GET.job_type == "Contract" %}selected{% endif %}>Contract</option>
                 <option value="Temporary" {% if request.GET.job_type == "Temporary" %}selected{% endif %}>Temporary</option>
                 <option value="Volunteer" {% if request.GET.job_type == "Volunteer" %}selected{% endif %}>Volunteer</option>
                 <option value="Internship" {% if request.GET.job_type == "Internship" %}selected{% endif %}>Internship</option>
                 <option value="Other" {% if request.GET.job_type == "Other" %}selected{% endif %}>Other</option>
                 </select>
                 <div class="input-group-append">
                    <button class="btn btn-outline-info" type="submit">Filter</button>
                    {% if request.GET.job_type %}
                    <a href="{% url 'employer_portal-manage_job_postings' %}" class="btn btn-secondary ml-2">Clear Filter</a>
                    {% endif %}
                 </div>
              </div>
            </form>
            <a href="#" class="btn btn-dark ml-auto" data-toggle="modal" data-target="#createJobModal">Create New Job Posting</a>
        </div>
        <div style="margin-bottom: 20px;"></div>
        <table class="table">
            <thead style="background-color: #004085; color: white;">
                <tr>
                    <th class="eye-column" style="width: 1%;"></th>
                    <th>Job Title</th>
                    <th>Location</th>
                    <th>Application Deadline</th>
                </tr>
            </thead>
            <tbody>
                {% for job in job_postings %}
                    <tr>
                        <td class="eye-column"><a href="#" data-toggle="modal" data-target="#jobModal-{{ job.job_id }}"><i class="fa fa-eye" style="color: #004085;"></i></a></td>
                        <td>{{ job.title }}</td>
                        <td>{{ job.location }}</td>
                        <td>{{ job.application_deadline }}</td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="4">No job postings found.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="modal fade" id="createJobModal" tabindex="-1" role="dialog" aria-labelledby="createJobModalLabel" aria-hidden="true">
          <div class="modal-dialog" role="document">
              <div class="modal-content">
                  <div class="modal-header">
                      <h5 class="modal-title" id="createJobModalLabel">Create New Job Posting</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                      </button>
                  </div>
                  <div class="modal-body">
                      <form method="post" action="{% url 'create_job_posting' %}">
                          {% csrf_token %}
                          <div class="form-group">
                              <label for="title">Title:</label>
                              <input type="text" name="title" class="form-control" required>
                          </div>
                          <div class="form-group">
                              <label for="company_name">Company Name:</label>
                              <input type="text" name="company_name" class="form-control" required>
                          </div>
                          <div class="form-group">
                             <label for="job_type">Job Type:</label>
                             <select name="job_type" class="form-control" required>
                                 <option value="" selected disabled>Select job type</option>
                                 <option value="Full-time">Full-time</option>
                                 <option value="Part-time">Part-time</option>
                                 <option value="Contract">Contract</option>
                                 <option value="Temporary">Temporary</option>
                                 <option value="Volunteer">Volunteer</option>
                                 <option value="Internship">Internship</option>
                                 <option value="Other">Other</option>
                            </select>
                          </div>
                          <div class="form-group">
                              <label for="job_category">Job Category:</label>
                              <select name="job_category" class="form-control" required>
                                  <option value="" selected disabled>Select job category</option>
                                  <option value="Education">Education</option>
                                  <option value="Business">Business</option>
                                  <option value="Healthcare">Healthcare</option>
                                  <option value="Technology">Technology</option>
                                  <option value="Arts and entertainment">Arts and entertainment</option>
                                  <option value="Other">Other</option>
                              </select>
                          </div>
                          <div class="form-group">
                              <label for="location">Location:</label>
                              <input type="text" name="location" class="form-control" required>
                          </div>
                          <div class="form-group">
                              <label for="salary">Salary:</label>
                              <input type="text" name="salary" class="form-control" required>
                          </div>
                          <div class="form-group">
                              <label for="description">Description:</label>
                              <textarea name="description" class="form-control" rows="5" required></textarea>
                          </div>
                          <div class="form-group">
                              <label for="requirements">Requirements:</label>
                              <textarea name="requirements" class="form-control" rows="5" required></textarea>
                          </div>
                          <div class="form-group">
                              <label for="application_deadline">Application Deadline:</label>
                              <input type="date" name="application_deadline" class="form-control" required>
                          </div>
                          <div class="form-group">
                              <label for="contact_info">Contact Info:</label>
                              <input type="text" name="contact_info" class="form-control" required>
                          </div>
                          <input type="hidden" name="employer" value="{{ request.user.profile.pk }}">
                          <button type="submit" class="btn btn-primary">Create Job Posting</button>
                      </form>
                  </div>
                  <div class="modal-footer">
                      <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                  </div>
              </div>
          </div>
        </div>

        {% for job in job_postings %}
            <div class="modal fade" id="jobModal-{{ job.job_id }}" tabindex="-1" role="dialog" aria-labelledby="jobModalLabel-{{ job.job_id }}" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="jobModalLabel-{{ job.job_id }}">{{ job.title }}</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <p>{{ job.description }}</p>
                            <p><strong>Location:</strong> {{ job.location }}</p>
                            <p><strong>Company Name:</strong> {{ job.company_name }}</p>
                            <p><strong>Type:</strong> {{ job.job_type }}</p>
                            <p><strong>Category:</strong> {{ job.job_category }}</p>
                            <p><strong>Requirements:</strong> {{ job.requirements }}</p>
                            <p><strong>Salary:</strong> {{ job.salary }}</p>
                            <p><strong>Application Deadline:</strong> {{ job.application_deadline }}</p>
                            <p><strong>Contact Info:</strong> {{ job.contact_info }}</p>
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
{% endblock %}